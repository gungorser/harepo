template:
  - trigger:
      - trigger: time_pattern
        hours: /1
    action:
      - action: weather.get_forecasts
        data:
          type: hourly
        target:
          entity_id: weather.forecast_home
        response_variable: hourly
    sensor:
      - name: Temperature forecast next hour
        unique_id: temperature_forecast_next_hour
        state: "{{ hourly['weather.forecast_home'].forecast[0].temperature }}"
        unit_of_measurement: Â°C

homeassistant:
  packages: !include_dir_named gungors/packages/thermostats

automation:
  - alias: "thermostat_switch"
    id: "thermostat_switch"
    description: ""
    triggers:
      - value_template: |-
          {{ ['number.sercan_climate_valve_opening_degree',
              'number.yatak_climate_valve_opening_degree',
              'number.melike_climate_valve_opening_degree',
              'number.bebek_climate_valve_opening_degree',
              'number.banyo_climate_valve_opening_degree',
              'number.misafir_climate_valve_opening_degree'] 
            | map('states')  
            | select('is_number')
            | map('float') | max > 0 }}
        trigger: template
        id: heat
      - value_template: |-
          {{ ['number.sercan_climate_valve_opening_degree',
              'number.yatak_climate_valve_opening_degree',
              'number.melike_climate_valve_opening_degree',
              'number.bebek_climate_valve_opening_degree',
              'number.banyo_climate_valve_opening_degree',
              'number.misafir_climate_valve_opening_degree'] 
            | map('states') 
            | select('is_number')
            | map('float') 
            | max == 0 }}
        trigger: template
        id: "off"
    conditions: []
    actions:
      - choose:
          - conditions:
              - condition: trigger
                id:
                  - heat
            sequence:
              - action: switch.turn_on
                metadata: {}
                data: {}
                target:
                  entity_id: switch.koridor2_switch
          - conditions: []
            sequence:
              - action: switch.turn_off
                metadata: {}
                data: {}
                target:
                  entity_id: switch.koridor2_switch
    mode: restart
